# API Documentation

## User Registration Endpoint

### POST `/user/register`

Register a new user in the system.

#### Request Body

```json
{
  "fullname": {
    "firstname": "string", // minimum 3 characters
    "lastname": "string"   // optional, minimum 3 characters if provided
  },
  "email": "string",      // valid email format
  "password": "string"    // minimum 6 characters
}
```

#### Validation Rules
- Email must be a valid email address
- First name must be at least 3 characters long
- Password must be at least 6 characters long
- Email must be unique (not already registered)

#### Success Response

**Code:** 201 CREATED

**Response Body:**
```json
{
  "token": "string", // JWT token valid for 24 hours
  "user": {
    "fullname": {
      "firstname": "string",
      "lastname": "string"
    },
    "email": "string",
    "_id": "string"
  }
}
```

#### Error Responses

**Code:** 400 BAD REQUEST
- When validation fails for any field
```json
{
  "errors": [
    {
      "msg": "Error message",
      "param": "field_name"
    }
  ]
}
```

**Code:** 400 BAD REQUEST
- When email is already registered
```json
{
  "error": "Email is already in use"
}
```

**Code:** 500 INTERNAL SERVER ERROR
- When server encounters an error during user creation
```json
{
  "error": "Internal server error message"
}
```

#### Notes
- The password is automatically hashed before storing
- A JWT token is generated upon successful registration
- The token expires in 24 hours
- The response will not include the password field

## User Login Endpoint

### POST `/user/login`

Authenticate an existing user and return a JWT token plus user data (password excluded).

#### Request Body

```json
{
  "email": "user@example.com",
  "password": "string"
}
```

#### Validation / Required Fields
- `email` (string) — required, must be a valid email address.
- `password` (string) — required, minimum 6 characters.

Validation rules are enforced in `routes/user.routes.js` using `express-validator`.

#### Success Response
- **Status:** 200 OK
- **Body:**

```json
{
  "token": "<jwt-token>",
  "user": {
    "_id": "<user-id>",
    "fullname": { "firstname": "First", "lastname": "Last" },
    "email": "user@example.com"
  }
}
```

Notes:
- The token is generated by `user.generateAuthToken()` (see `models/user.model.js`) and typically expires in 24 hours.
- The controller loads the user including the password (`.select('+password')`) and uses bcrypt to compare the provided password.

#### Error Responses

- **400 Bad Request** — validation errors

```json
{
  "errors": [
    { "msg": "Invalid email address", "param": "email" }
  ]
}
```

- **401 Unauthorized** — invalid credentials

```json
{ "error": "Invalid email or password" }
```

- **500 Internal Server Error** — unexpected server error during login

```json
{ "error": "Internal server error message" }
```

## User Profile Endpoint

### GET `/user/profile`

Return the authenticated user's profile information. This route is protected and requires a valid JWT.

#### Authentication
- Provide a valid JWT in the `Authorization` header as `Bearer <token>` or via the `token` httpOnly cookie set at login. The controller and middleware support both approaches.

#### Success Response
- **Status:** 200 OK
- **Body:**

```json
{
  "_id": "<user-id>",
  "fullname": { "firstname": "First", "lastname": "Last" },
  "email": "user@example.com"
}
```

#### Error Responses
- **401 Unauthorized** — when no token is provided or token is invalid/expired

```json
{ "error": "Unauthorized" }
```

- **500 Internal Server Error** — unexpected server error

```json
{ "error": "Internal server error message" }
```

## User Logout Endpoint

### GET `/user/logout`

Invalidate the current user's session by clearing the auth cookie and adding the token to a blacklist (stored with a 24-hour TTL).

#### Authentication
- Must be called by an authenticated user. The token is typically taken from the `token` httpOnly cookie or the `Authorization: Bearer <token>` header.

#### Success Response
- **Status:** 200 OK
- **Body:**

```json
{ "message": "Logged out successfully" }
```

#### Behavior
- The controller clears the `token` cookie and stores the token in a blacklist collection that expires after 24 hours (so the token cannot be reused during its remaining lifetime).

#### Error Responses
- **401 Unauthorized** — when the user is not authenticated

```json
{ "error": "Unauthorized" }
```

- **500 Internal Server Error** — unexpected server error while blacklisting token or clearing cookie

```json
{ "error": "Internal server error message" }
```

