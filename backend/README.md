# API Documentation

## User Registration Endpoint

### POST `/user/register`

Register a new user in the system.

#### Request Body

```json
{
  "fullname": {
    "firstname": "string", // minimum 3 characters
    "lastname": "string"   // optional, minimum 3 characters if provided
  },
  "email": "string",      // valid email format
  "password": "string"    // minimum 6 characters
}
```

#### Validation Rules
- Email must be a valid email address
- First name must be at least 3 characters long
- Password must be at least 6 characters long
- Email must be unique (not already registered)

#### Success Response

**Code:** 201 CREATED

**Response Body:**
```json
{
  "token": "string", // JWT token valid for 24 hours
  "user": {
    "fullname": {
      "firstname": "string",
      "lastname": "string"
    },
    "email": "string",
    "_id": "string"
  }
}
```

#### Error Responses

**Code:** 400 BAD REQUEST
- When validation fails for any field
```json
{
  "errors": [
    {
      "msg": "Error message",
      "param": "field_name"
    }
  ]
}
```

**Code:** 400 BAD REQUEST
- When email is already registered
```json
{
  "error": "Email is already in use"
}
```

**Code:** 500 INTERNAL SERVER ERROR
- When server encounters an error during user creation
```json
{
  "error": "Internal server error message"
}
```

#### Notes
- The password is automatically hashed before storing
- A JWT token is generated upon successful registration
- The token expires in 24 hours
- The response will not include the password field

## User Login Endpoint

### POST `/user/login`

Authenticate an existing user and return a JWT token plus user data (password excluded).

#### Request Body

```json
{
  "email": "user@example.com",
  "password": "string"
}
```

#### Validation / Required Fields
- `email` (string) — required, must be a valid email address.
- `password` (string) — required, minimum 6 characters.

Validation rules are enforced in `routes/user.routes.js` using `express-validator`.

#### Success Response
- **Status:** 200 OK
- **Body:**

```json
{
  "token": "<jwt-token>",
  "user": {
    "_id": "<user-id>",
    "fullname": { "firstname": "First", "lastname": "Last" },
    "email": "user@example.com"
  }
}
```

Notes:
- The token is generated by `user.generateAuthToken()` (see `models/user.model.js`) and typically expires in 24 hours.
- The controller loads the user including the password (`.select('+password')`) and uses bcrypt to compare the provided password.

#### Error Responses

- **400 Bad Request** — validation errors

```json
{
  "errors": [
    { "msg": "Invalid email address", "param": "email" }
  ]
}
```

- **401 Unauthorized** — invalid credentials

```json
{ "error": "Invalid email or password" }
```

- **500 Internal Server Error** — unexpected server error during login

```json
{ "error": "Internal server error message" }
```

## User Profile Endpoint

### GET `/user/profile`

Return the authenticated user's profile information. This route is protected and requires a valid JWT.

#### Authentication
- Provide a valid JWT in the `Authorization` header as `Bearer <token>` or via the `token` httpOnly cookie set at login. The controller and middleware support both approaches.

#### Success Response
- **Status:** 200 OK
- **Body:**

```json
{
  "_id": "<user-id>",
  "fullname": { "firstname": "First", "lastname": "Last" },
  "email": "user@example.com"
}
```

#### Error Responses
- **401 Unauthorized** — when no token is provided or token is invalid/expired

```json
{ "error": "Unauthorized" }
```

- **500 Internal Server Error** — unexpected server error

```json
{ "error": "Internal server error message" }
```

## User Logout Endpoint

### GET `/user/logout`

Invalidate the current user's session by clearing the auth cookie and adding the token to a blacklist (stored with a 24-hour TTL).

#### Authentication
- Must be called by an authenticated user. The token is typically taken from the `token` httpOnly cookie or the `Authorization: Bearer <token>` header.

#### Success Response
- **Status:** 200 OK
- **Body:**

```json
{ "message": "Logged out successfully" }
```

#### Behavior
- The controller clears the `token` cookie and stores the token in a blacklist collection that expires after 24 hours (so the token cannot be reused during its remaining lifetime).

#### Error Responses
- **401 Unauthorized** — when the user is not authenticated

```json
{ "error": "Unauthorized" }
```

- **500 Internal Server Error** — unexpected server error while blacklisting token or clearing cookie

```json
{ "error": "Internal server error message" }
```

# Captain API Documentation

## Captain Registration Endpoint

### POST `/captain/register`

Register a new captain in the system with vehicle details.

#### Request Body

```json
{
  "fullname": {
    "firstname": "string",    // minimum 3 characters
    "lastname": "string"      // optional, minimum 3 characters if provided
  },
  "email": "string",         // valid email format
  "password": "string",      // minimum 6 characters
  "vehicle": {
    "color": "string",       // minimum 3 characters
    "plate": "string",       // minimum 3 characters
    "capacity": number,      // minimum 1
    "vehicleType": "string"  // enum: "car", "motorcycle", "auto"
  }
}
```

#### Validation Rules
- Email must be a valid email address and unique
- First name must be at least 3 characters long
- Password must be at least 6 characters long
- Vehicle color must be at least 3 characters long
- Vehicle plate number must be at least 3 characters long
- Vehicle capacity must be at least 1
- Vehicle type must be one of: "car", "motorcycle", "auto"

#### Success Response

**Code:** 201 CREATED

**Response Body:**
```json
{
  "token": "string",    // JWT token valid for 24 hours
  "captain": {
    "_id": "string",
    "fullname": {
      "firstname": "string",
      "lastname": "string"
    },
    "email": "string",
    "vehicle": {
      "color": "string",
      "plate": "string",
      "capacity": number,
      "vehicleType": "string"
    },
    "status": "inactive", // default status
    "location": {
      "ltd": null,
      "lng": null
    }
  }
}
```

#### Error Responses

**Code:** 400 BAD REQUEST
- When validation fails for any field
```json
{
  "errors": [
    {
      "msg": "Error message",
      "param": "field_name"
    }
  ]
}
```

**Code:** 400 BAD REQUEST
- When email is already registered
```json
{
  "message": "Captain already exist"
}
```

**Code:** 500 INTERNAL SERVER ERROR
- When server encounters an error during captain creation
```json
{
  "error": "Internal server error message"
}
```

#### Notes
- The password is automatically hashed before storing
- A JWT token is generated upon successful registration
- The token expires in 24 hours
- New captains are created with "inactive" status by default
- Location coordinates (ltd/lng) are initially null until updated
- The response will not include the password field

## Captain Login Endpoint

### POST `/captain/login`

Authenticate an existing captain and return a JWT token plus captain data (password excluded).

#### Request Body

```json
{
  "email": "captain@example.com",
  "password": "string"
}
```

#### Validation Rules
- Email must be a valid email address
- Password must be at least 6 characters long

#### Success Response
- **Status:** 200 OK
- **Body:**

```json
{
  "token": "<jwt-token>",
  "captain": {
    "_id": "<captain-id>",
    "fullname": {
      "firstname": "string",
      "lastname": "string"
    },
    "email": "string",
    "vehicle": {
      "color": "string",
      "plate": "string",
      "capacity": number,
      "vehicleType": "string"
    },
    "status": "string",
    "location": {
      "ltd": number,
      "lng": number
    }
  }
}
```

Notes:
- The token is stored as an httpOnly cookie
- The token expires in 24 hours
- Password field is excluded from the response

#### Error Responses

- **400 Bad Request** — validation errors
```json
{
  "errors": [
    { "msg": "Invalid email address", "param": "email" }
  ]
}
```

- **401 Unauthorized** — invalid credentials
```json
{ "error": "Invalid email or password" }
```

## Captain Profile Endpoint

### GET `/captain/profile`

Return the authenticated captain's profile information including vehicle and status details.

#### Authentication
- Requires valid JWT token in `Authorization: Bearer <token>` header or `token` cookie
- Token must not be blacklisted

#### Success Response
- **Status:** 200 OK
- **Body:**

```json
{
  "_id": "<captain-id>",
  "fullname": {
    "firstname": "string",
    "lastname": "string"
  },
  "email": "string",
  "vehicle": {
    "color": "string",
    "plate": "string",
    "capacity": number,
    "vehicleType": "string"
  },
  "status": "string",
  "location": {
    "ltd": number,
    "lng": number
  }
}
```

#### Error Responses

- **401 Unauthorized** — no token or invalid token
```json
{ "message": "unauthorized, no token provided" }
```

- **401 Unauthorized** — blacklisted token
```json
{ "message": "unauthorized, token is blacklisted" }
```

## Captain Logout Endpoint

### GET `/captain/logout`

Invalidate the captain's session by clearing the auth cookie and blacklisting the token.

#### Authentication
- Requires valid JWT token in `Authorization: Bearer <token>` header or `token` cookie
- Token must not be already blacklisted

#### Success Response
- **Status:** 200 OK
- **Body:**

```json
{ "message": "Logged out successfully" }
```

#### Behavior
- Clears the `token` cookie
- Adds the token to blacklist collection (expires after 24 hours)
- Prevents token reuse during its remaining lifetime

#### Error Responses

- **401 Unauthorized** — no token or invalid token
```json
{ "message": "unauthorized, no token provided" }
```

- **401 Unauthorized** — already blacklisted token
```json
{ "message": "unauthorized, token is blacklisted" }
```
